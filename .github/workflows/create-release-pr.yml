name: ü•å Create publication PR
run-name: Create publication PR [${{ github.actor }}]

permissions:
  pull-requests: write

on:
  workflow_dispatch:
    inputs:
      releaseBranch:
        required: true
        description: Release branch name
      mergeTarget:
        required: true
        default: 'main'
        description: Merge target for PR

jobs:
  create-pr:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN:   ${{ secrets.GITHUB_TOKEN }}
      prTitle:     "[PUBLISH] ${{ github.event.inputs.releaseBranch }}"
      prBody: |
        üöß \`${{ github.repository }}\` publication PR

        **Triggered by**: @${{ github.actor }} with a Github action
        **Release branch**: \`${{ github.event.inputs.releaseBranch }}\`
        **Merge target**:   \`${{ github.event.inputs.mergeTarget }}\`

    steps:
      - name: Check out repository code
        uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
        with:
          fetch-depth: 0
      - name: Create pull request
        run: |
          gh pr create                                       \
            --base  ${{ github.event.inputs.mergeTarget }}   \
            --head  ${{ github.event.inputs.releaseBranch }} \
            --title "${{ env.prTitle }}"                     \
            --body  "${{ env.prBody }}"
      - name: Wrap-up
        run: |
          echo "üçè Final job status:  ${{ job.status }}"
