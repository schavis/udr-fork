name: Create release branch PR
run-name: üöÄ Creating ${{ env.product }} release PR

permissions: 
  contents: write

on: 
  workflow_dispatch:
    inputs:
      product:
        required: true
        description: >-
          Product slug (e.g., vault, hcp)
      branch-name:
        required: true
        description: >-
          Release branch name. Monthly release branches use YYYYMM notation.
          Major release branches use the corresponding content version

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Debugging data
        run: |
          echo "üöß ${{ github.repository }} - Creating PR"
          echo "    - Release branch: $RELEASE_BRANCH"
          echo "    - Merge target:   $MERGE_TARGET"
          echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - name: Create pull request
        run: |
          gh pr create          \
            -B $MERGE_TARGET    \
            -H $RELEASE_BRANCH  \
            --label $LABELS     \
            --title $PR_TITLE   \
            --body $PR_BODY
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            RELEASE_BRANCH: "${{ github.event.inputs.product }}/${{ github.event.inputs.branch-name }}"
            MERGE_TARGET: "main"
            LABELS: "${{ inputs.product }}-docs"
            PR_TITLE: "[PUBLISH] ${{ github.event.inputs.product }}/${{ github.event.inputs.branch-name }}"
            PR_BODY: |
              Merging ${{ github.event.inputs.product }}/${{ github.event.inputs.branch-name }}
              Created by Github action
      - name: Wrap-up
        run: echo "üçè This job's status is ${{ job.status }}."
